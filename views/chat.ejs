<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุงููุฉ ููุฏูู ุจุงุณุชุฎุฏุงู PeerJS</title>
    <link rel="stylesheet" href="/styles.css">
  
</head>
<body>
    <div id="ng"></div>
    <input type="text" value="<%=namemy%>" name="nam" id="nam">
    <input type="text" value="<%=my_id%>" name="myid" id="myid">
    <input type="text" value="<%=id%>" name="frid_id" id="idfrend">
    <button onclick="insert()">ุฅุฑุณุงู</button>
  <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>ุงููุญุงุฏุซุงุช</h2>
            </div>
  <a href=""></a>
<%=idusr%>
    <% results.forEach(resul=>{ %>
    <p><%=resul.id%></p>
    <p> <a href="/chat/<%=resul.id%>"><%=resul.emil%></a></p>
    <%})%>

          
         
        </div>
        <div class="chat-area">
            <div class="header">
                <button title="ููุงููุฉ ุตูุชูุฉ">๐</button> <!-- ุฃููููุฉ ููุงููุฉ ุตูุชูุฉ -->
                <button title="ููุงููุฉ ููุฏูู">๐น</button> <!-- ุฃููููุฉ ููุงููุฉ ููุฏูู -->
                <button id="toggleSidebar" title="ุฅุธูุงุฑ/ุฅุฎูุงุก ูุงุฆูุฉ ุงูุฃุตุฏูุงุก">โฐ</button> <!-- ุฒุฑ ูุชุจุฏูู ุงููุงุฆูุฉ -->
            </div>
            <div class="messages">
                <div class="message sent">
                    <p>ูุฑุญุจุง! ููู ุญุงููุ</p>
                </div>
                <div class="message received">
                    <p>ุฃูุง ุจุฎูุฑุ ุดูุฑูุง! ูุฃูุชุ</p>
                </div>
            </div>
            <div class="media-controls">
                <button title="ุชุณุฌูู ุงูุตูุช">๐ค</button> <!-- ุฃููููุฉ ุชุณุฌูู ุงูุตูุช -->
                <button title="ุชุญููู ุงูุตูุฑ">๐ผ๏ธ</button> <!-- ุฃููููุฉ ุชุญููู ุงูุตูุฑ -->
                <button title="ุชุญููู ุงูููุฏูู">๐ฅ</button> <!-- ุฃููููุฉ ุชุญููู ุงูููุฏูู -->
                <button title="ุชุญููู ุงููุณุงุฆุท">๐</button> <!-- ุฃููููุฉ ุชุญููู ุงููุณุงุฆุท -->
            </div>
            <div class="input-area">
                <input type="text" placeholder="ุงูุชุจ ุฑุณุงูุฉ...">
                <button>ุฅุฑุณุงู</button>
            </div>
        </div>
    </div>


      <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script>
  let nam = document.getElementById('nam').value;
let myid = document.getElementById('myid').value;
let idfrend = document.getElementById('idfrend').value;

        const socket = io();
        let peer = new Peer();
        let peerid = null;

        peer.on('open', id => {
            console.log('me', id);
            peerid = id;
        });

        function insert() {
            let myid = {
                myid: peerid,
            };
            let deta = {
                nam: document.getElementById('nam').value,
                to: document.getElementById('idfrend').value, 
                from: peerid, 
            };
            socket.emit('reqorst', myid);
         
            // ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชูุจู
            socket.emit('callNotification', deta);
        }

        socket.on('getpeerid', () => {
            socket.emit('sendpeerid', {
                myid: document.getElementById('myid').value,
                peerid: peerid
            });
        });

        socket.on('reccadd', id => {
            console.log(id);
            sessionStorage.setItem('FRpeerId', id);
     sessionStorage.setItem('MYpeerId', peerid);
            window.location.href = "/call";
        });

        socket.on('urls', (deta) => {
            document.getElementById('ng').innerHTML = `
                <div class="video-call-message">
                    <p>ููุงููุฉ ููุฏูู ูุงุฑุฏุฉ...</p>
                    <p>${deta.nam}</p>
                    <div class="video-call-buttons">
                        <button id="rd" class="answer">ุฑุฏ</button>
                        <button class="decline">ุฑูุถ</button>
                    </div>
                </div>
            `;
    let button = document.getElementById('rd');
    button.addEventListener('click', () => {
       sessionStorage.setItem('FRpeerId', deta.from); 
        window.location.href = "/call";
    });
        });
       const toggleSidebarButton = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');

        toggleSidebarButton.addEventListener('click', () => {
            sidebar.classList.toggle('open'); // ุฅุถุงูุฉ ุฃู ุฅุฒุงูุฉ ุงููุฆุฉ 'open'
    </script>
</body>
</html>
